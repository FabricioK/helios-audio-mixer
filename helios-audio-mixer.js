!function e(t,o,n){function i(r,a){if(!o[r]){if(!t[r]){var u="function"==typeof require&&require;if(!a&&u)return u(r,!0);if(s)return s(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var p=o[r]={exports:{}};t[r][0].call(p.exports,function(e){var o=t[r][1][e];return i(o?o:e)},p,p.exports,e,t,o,n)}return o[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(e,t,o){var n=e("./mix");window.heliosAudioMixer=n},{"./mix":4}],2:[function(e,t,o){var n=e("./utils"),i={};t.exports=i,i.level=1,i.log=function(e){if(e<=i.level){for(var t="[Mixer] ",o=1;o<arguments.length;o++)t+=arguments[o]+" ";console.log(t)}},i.setLogLvl=function(e){this.debug=n.constrain(e,0,2),i.log(1,"Set log level:",e)}},{"./utils":6}],3:[function(e,t,o){var n={};n.webAudio=!(!window.AudioContext&&!window.webkitAudioContext),n.audioTypes=function(){var e=document.createElement("audio");return{".m4a":!(!e.canPlayType||!e.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/,"")),".mp3":!(!e.canPlayType||!e.canPlayType("audio/mpeg;").replace(/no/,"")),".ogg":!(!e.canPlayType||!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))}}(),n.videoTypes=function(){var e=document.createElement("video");return{".webm":!(!e.canPlayType||!e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/no/,"")),".mp4":!(!e.canPlayType||!e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,"")),".ogv":!(!e.canPlayType||!e.canPlayType('video/ogg; codecs="theora"').replace(/no/,""))}}(),n.browser=function(){return"undefined"!=typeof bowser?bowser:{firefox:!!navigator.userAgent.match(/Firefox/g),android:!!navigator.userAgent.match(/Android/g),msie:!!navigator.userAgent.match(/MSIE/g),ios:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),version:!1}}(),n.tween=function(){return"undefined"==typeof TWEEN?!1:!0}(),t.exports=n},{}],4:[function(e,t,o){var n=e("./utils"),i=e("./track"),s=e("./detect"),r=e("./debug"),a=function(e){this.Track=i,this.setLogLvl=r.setLogLvl;var t={fileTypes:[".mp3",".m4a",".ogg"],html5:!1,gain:1};this.options=n.extend(t,e||{}),this.tracks=[],this.lookup={},this.muted=!1,this.context=null,this.detect=s,("Firefox"===s.browser.name&&s.version&&s.version<25||s.browser.ios===!0&&7===s.browser.version||this.options.html5)&&(s.webAudio=!1);for(var o=this.options.fileTypes.length-1;o>=0;o--)s.audioTypes[this.options.fileTypes[o]]||this.options.fileTypes.splice(o,1);return this.options.fileTypes.length<=0?void console.warn("Can’t initialize: none of the specified audio types can play in this browser."):(s.webAudio===!0&&(this.context="function"==typeof AudioContext?new window.AudioContext:new window.webkitAudioContext),r.log(1,"initialized,",s.webAudio?"Web Audio Mode,":"HTML5 Mode,","can play:",this.options.fileTypes),this)};a.prototype.on=n.events.on,a.prototype.one=n.events.one,a.prototype.off=n.events.off,a.prototype.trigger=n.events.trigger,a.prototype.createTrack=function(e,t){var o,a=this;if(e||r.log(0,"Can’t create track with no name"),s.webAudio===!0){if(this.lookup[e])return void r.log(0,"a track named “"+a.name+"” already exists");o=new i(e,t,a),this.tracks.push(o),this.lookup[e]=o}else o=this.lookup[e],o?(o.pause(),o.options=n.extend(o,o.defaults,t||{}),o.options.source&&(o.options.source+=a.mix.options.fileTypes[0],o.createHTML5elementSource())):(o=new i(e,t,a),this.tracks.push(o),this.lookup[e]=o);return o},a.prototype.removeTrack=function(e){var t,o,n=this;"string"==typeof e?o=e:"object"==typeof e&&e.name&&(o=e.name);var t=n.lookup[o];if(!t)return void r.log(1,'can’t remove "'+o+'", it doesn’t exist');if(s.webAudio===!0){t.pause();for(var i,a=n.tracks,u=a.length,c=0;u>c;c++)a[c]&&a[c].name===o&&(i=a.slice(c+1||u),a.length=0>c?u+c:c,a.push.apply(a,i));t.trigger("remove",n),t.events=[],"element"===t.options.sourceMode&&t.element&&(t.element.src=""),t=null,delete n.lookup[o],r.log(1,'Removed track "'+o+'"')}else t.pause(),t.element.src="",t.source="",t.ready=!1,t.loaded=!1},a.prototype.getTrack=function(e){return this.lookup[e]||!1},a.prototype.pause=function(){r.log(1,"Pausing "+this.tracks.length+" track(s) ||");for(var e=0;e<this.tracks.length;e++)this.tracks[e].pause()},a.prototype.play=function(){r.log(1,"Playing "+this.tracks.length+" track(s) >");for(var e=0;e<this.tracks.length;e++)this.tracks[e].play()},a.prototype.stop=function(){r.log(1,"Stopping "+this.tracks.length+" track(s) .");for(var e=0;e<this.tracks.length;e++)this.tracks[e].stop()},a.prototype.mute=function(){if(!this.muted){this.muted=!0,r.log(1,"Muting "+this.tracks.length+" tracks");for(var e=0;e<this.tracks.length;e++)this.tracks[e].mute()}},a.prototype.unmute=function(){if(this.muted){this.muted=!1,r.log(1,"Unmuting "+this.tracks.length+" tracks");for(var e=0;e<this.tracks.length;e++)this.tracks[e].unmute()}},a.prototype.gain=function(e){if("undefined"!=typeof e){this.options.gain=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].gain(this.tracks[t].gain())}return this.options.gain},a.prototype.updateTween=function(){TWEEN.update()},a.prototype.report=function(){for(var e="",t=0;t<this.tracks.length;t++)e+=this.tracks[t].gain()+"	"+this.tracks[t].currentTime()+"	"+this.tracks[t].name+"\n";console.log(e)},t.exports=a},{"./debug":2,"./detect":3,"./track":5,"./utils":6}],5:[function(e,t,o){function n(e){if(p.log(2,'Creating nodes for track "'+e.name+'"'),e.nodes={},e.addNode("panner").addNode("gain"),e.options.nodes.length)for(var t=0;t<e.options.nodes.length;t++)e.addNode(e.options.nodes[t]);e.nodes.lastnode.connect(e.mix.context.destination)}function i(e){e.nodes||(n(e),e.element.addEventListener("ended",function(){e.trigger("ended",e)},!1)),e.status.ready=!0,e.trigger("ready",e),e.options.looping?e.element.loop=!0:e.element.loop=!1,e.gain(e.options.gain),e.pan(e.options.pan),e.options.startTime=e.element.currentTime-e.options.cachedTime;var t=e.options.cachedTime||0;p.log(1,'Playing track "'+e.name+'" from '+t+" ("+e.options.startTime+") gain "+e.gain()),e.element.currentTime=t,e.element.play(),e.trigger("play",e)}function s(){var e=this,t=e.options.cachedTime||0,o=e.source.buffer.duration-t;e.onendtimer=setTimeout(function(){e.trigger("ended",e),e.options.looping&&(bowser&&bowser.chrome&&Math.floor(bowser.version)>=42?(e.stop(),e.play()):s.call(e))},1e3*o)}function r(e){e.status.ready=!1,e.source=null;var t=function(){n(e),e.status.ready=!0,e.trigger("ready",e),e.source.loop=e.options.looping?!0:!1,e.gain(e.options.gain),e.pan(e.options.pan),e.options.startTime=e.source.context.currentTime-e.options.cachedTime;var t=e.options.cachedTime||0;p.log(2,'Playing track "'+e.name+'" from '+t+" ("+e.options.startTime+") gain "+e.gain()),"function"==typeof e.source.start?e.source.start(0,t):e.source.noteOn(t),e.onendtimer=!1,s.call(e),e.trigger("play",e)};if("function"==typeof e.mix.context.createGain)e.mix.context.decodeAudioData(e.options.audioData,function(o){if(!e.status.ready){e.source=e.mix.context.createBufferSource();var n=o;e.source.buffer=n,t()}});else if("function"==typeof e.mix.context.createGainNode){e.source=e.mix.context.createBufferSource();var o=e.mix.context.createBuffer(e.options.audioData,!0);e.source.buffer=o,t()}}function a(e){p.log(1,'Playing track "'+e.name+'" >'),e.gain(e.options.gain),e.status.ready=!0,e.element.play(),e.trigger("play",e)}function u(e){var t=Math.floor(e/60)<10?"0"+Math.floor(e/60):Math.floor(e/60),o=Math.floor(e-60*t)<10?"0"+Math.floor(e-60*t):Math.floor(e-60*t);return t+":"+o}var c=e("./utils"),p=(e("./detect"),e("./debug")),d=function(e,t,o){if(this.defaults={sourceMode:"buffer",source:!1,nodes:[],gain:1,gainCache:!1,pan:0,panX:0,panY:0,panZ:0,start:0,cachedTime:0,startTime:0,looping:!1,autoplay:!0,muted:o.muted?!0:!1},this.options=c.extend(this.defaults,t||{}),this.options.gainCache===!1&&(this.options.gainCache=this.options.gain),this.name=e,this.status={loaded:!1,ready:!1,playing:!1},this.mix=o,this.events={},this.tweens={},this.nodes=void 0,this.onendtimer=void 0,this.element=void 0,this.source=void 0,"string"==typeof this.options.source&&0!==this.options.source.indexOf("blob:")?this.options.source+=this.mix.options.fileTypes[0]:"object"==typeof this.options.source&&(this.options.sourceMode="element"),p.log(1,'createTrack "'+this.name+'", mode: "'+this.options.sourceMode+'", autoplay: '+this.options.autoplay),Detect.webAudio===!0){if(!this.options.source)return void p.log(1,'Creating track "'+e+'" without a source');"buffer"===this.options.sourceMode?this.loadBufferSource():"element"===this.options.sourceMode&&("object"==typeof this.options.source?this.useHTML5elementSource():this.createHTML5elementSource())}else{if(p.log(1,"creating html5 element for track "+e),this.element=document.querySelector("audio#"+e),!this.element){var n=document.createElement("audio");n.id=e,document.body.appendChild(n),this.element=document.querySelector("audio#"+e)}var i=function(){this.status.loaded||(this.status.loaded=!0,this.status.ready=!0,this.options.autoplay||this.pause(),this.trigger("load",this))},s=this;s.element.addEventListener("canplaythrough",i,!1),s.element.addEventListener("load",i,!1),s.element.addEventListener("ended",function(){s.options.looping?(p.log(2,"Track "+s.name+" looping"),s.element.currentTime=0,s.element.play()):(s.trigger("ended",s),s.mix.removeTrack(s.name))},!1),this.createHTML5elementSource(this.options.source)}};d.prototype.on=c.events.on,d.prototype.one=c.events.one,d.prototype.off=c.events.off,d.prototype.trigger=c.events.trigger,d.prototype.createHTML5elementSource=function(){var e=this;if(e.options.source){p.log(2,'Track "'+this.name+'" creating HTML5 element source: "'+e.options.source+e.mix.options.fileTypes[0]+'"'),e.status.ready=!1;var t=e.options.source;e.options.source=document.createElement("audio"),e.options.source.crossOrigin="",e.options.source.src=t,e.useHTML5elementSource()}},d.prototype.useHTML5elementSource=function(){var e=this;if(e.options.source){p.log(2,'Track "'+this.name+'" use HTML5 element source: "'+e.options.source+'"'),e.element=e.options.source,e.options.source.crossOrigin="",e.options.source=e.element.src,e.options.looping&&(e.element.loop=!0),e.options.muted&&(e.element.muted=!0),e.mix.context&&(e.source=e.mix.context.createMediaElementSource(e.element));var t=function(){e.status.loaded=!0,e.options.autoplay&&e.play(),e.trigger("load",e)};return e.element.addEventListener("canplaythrough",t),e.element.addEventListener("error",function(){e.trigger("loadError")}),e.element.load(),e}},d.prototype.loadBufferSource=function(e){var t=this;if(t.options.source){p.log(2,'Track "'+this.name+'" webAudio source: "'+t.options.source+'"');var o=new XMLHttpRequest;o.open("GET",t.options.source,!0),o.responseType="arraybuffer",o.onload=function(){p.log(2,'"'+t.name+'" loaded "'+t.options.source+'"'),t.options.audioData=o.response,t.status.loaded=!0,t.trigger("load",t),e?t.play(!0):t.options.autoplay&&t.play()},o.onerror=function(){p.log(1,'couldn’t load track "'+t.name+'" with source "'+t.options.source+'"'),t.trigger("loadError",t)},o.send()}},d.prototype.addNode=function(e){var t=this;if(t.nodes.lastnode||(t.nodes.lastnode=t.source),p.log(2," +  addNode "+e),"analyse"===e){t.nodes.processor=t.mix.context.createScriptProcessor(2048,1,1),t.nodes.analyser=t.mix.context.createAnalyser(),t.nodes.analyser.smoothingTimeConstant=.5,t.nodes.analyser.fftSize=32,t.nodes.processor.connect(t.mix.context.destination),t.nodes.analyser.connect(t.nodes.processor),t.options.bufferLength=new Uint8Array(t.nodes.analyser.frequencyBinCount);var o=new Uint8Array(t.options.bufferLength);t.nodes.lastnode.connect(t.nodes.analyser),t.nodes.processor.onaudioprocess=function(){t.nodes.analyser.getByteTimeDomainData(o),t.trigger("analyse",o)}}else if("gain"===e)t.mix.context.createGainNode?t.nodes.gain=t.mix.context.createGainNode():t.nodes.gain=t.mix.context.createGain(),t.nodes.lastnode.connect(t.nodes.gain),t.nodes.lastnode=t.nodes.gain;else if("panner"===e){if(window.AudioContext)t.nodes.panner=t.mix.context.createPanner();else{if(!window.webkitAudioContext)return t;t.nodes.panner=t.mix.context.createPanner()}t.nodes.lastnode.connect(t.nodes.panner),t.nodes.lastnode=t.nodes.panner}else if("convolver"===e){if(!t.mix.context.createConvolver)return t;t.nodes.convolver=t.mix.context.createConvolver()}else"compressor"===e?(t.nodes.compressor=t.mix.context.createDynamicsCompressor(),t.nodes.lastnode.connect(t.nodes.compressor),t.nodes.lastnode=t.nodes.compressor):"delay"===e&&(Detect.nodes.delayNode?t.nodes.delay=t.mix.context.createDelayNode():t.nodes.delay=t.mix.context.createDelay(),t.nodes.delay.delayTime=0,t.nodes.lastnode.connect(t.nodes.delay),t.nodes.lastnode=t.nodes.delay);return t},d.prototype.play=function(e){var t=this;if(!t.status.loaded)return void p.log(1,'Can’t play track "'+t.name+'", not loaded');if(t.status.playing!==!0)return t.status.playing=!0,Detect.webAudio?Detect.webAudio&&"buffer"===t.options.sourceMode?e?r(t):(t.status.playing=!1,t.loadBufferSource(!0)):Detect.webAudio&&"element"===t.options.sourceMode&&i(t):a(t),t},d.prototype.pause=function(e){if(this.status.ready&&this.status.playing){var t=this;return"number"==typeof e?t.options.cachedTime=e:t.options.cachedTime=t.currentTime(),t.status.playing=!1,t.onendtimer&&clearTimeout(t.onendtimer),Detect.webAudio===!0?"buffer"===t.options.sourceMode?"function"==typeof t.source.stop?t.source.stop(0):"function"==typeof t.source.noteOff&&t.source.noteOff(0):"element"===t.options.sourceMode&&t.element.pause():t.element.pause(),p.log(2,'Pausing track "'+t.name+'" at '+t.options.cachedTime),t.trigger("pause",t),t}},d.prototype.stop=function(){if(this.status.ready&&this.status.playing){var e=this;if(e.status.playing)return e.onendtimer&&clearTimeout(e.onendtimer),e.options.cachedTime=e.options.startTime=0,Detect.webAudio===!0&&"buffer"===e.options.sourceMode?"function"==typeof e.source.stop?e.source.stop(0):"function"==typeof e.source.noteOff&&e.source.noteOff(0):(e.options.autoplay=!1,e.element.pause(),e.element.currentTime=0),p.log(2,'Stopping track "'+e.name),e.status.playing=!1,e.trigger("stop",e),e.options.gain=e.options.gainCache,e}},d.prototype.pan=function(e){if(Detect.webAudio&&this.status.ready&&this.nodes.panner){if("string"==typeof e&&("front"===e?e=0:"back"===e?e=180:"left"===e?e=270:"right"===e&&(e=90)),"number"==typeof e){this.options.pan=e%360;var t=.017453292519943295*(-e+90),o=this.options.panX=Math.cos(t),n=this.options.panY=Math.sin(t),i=this.options.panZ=-.5;return this.nodes.panner.setPosition(o,n,i),this.trigger("pan",this.options.pan,this),this}return this.options.pan}},d.prototype.tweenPan=function(e,t){var o=this;return new Promise(function(n,i){return Detect.tween&&Detect.webAudio&&o.status.ready&&o.nodes.panner||i(Error("nope nope nope")),("number"!=typeof e||"number"!=typeof t)&&i(Error("Not a valid tween duration.")),p.log(2,'"'+o.name+'" tweening pan2d'),o.tweens.pan&&o.tweens.pan.stop(),o.tweens.pan=new TWEEN.Tween({currentAngle:o.options.pan}).to({currentAngle:e},t).easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function(){o.pan(this.currentAngle)}).onComplete(function(){n(o)}).start(),o})},d.prototype.gainCache=function(e){return"number"==typeof e?(this.options.gainCache=e,this):this.options.gainCache},d.prototype.gain=function(e){return"number"==typeof e?(e=c.constrain(e,0,1),this.options.muted?(this.gainCache(e),this.options.gain=0):this.options.gain=e,this.status.playing&&(Detect.webAudio?this.nodes&&this.nodes.gain&&(this.nodes.gain.gain.value=this.options.gain*this.mix.options.gain):this.element.volume=this.options.gain*this.mix.options.gain),p.log(2,'"'+this.name+'" setting gain to '+this.options.gain),this.trigger("gain",this.options.gain,this),this):this.options.gain},d.prototype.tweenGain=function(e,t){var o=this;return new Promise(function(n,i){("number"!=typeof e||"number"!=typeof t)&&i(Error("Invalid value for duration.")),p.log(2,'"'+o.name+'" tweening gain '+o.options.gain+" -> "+e+" ("+t+"ms)"),o.tweens.gain&&o.tweens.gain.stop(),o.tweens.gain=new TWEEN.Tween({currentGain:o.options.gain}).to({currentGain:e},t).easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function(){o.gain(this.currentGain)}).onComplete(function(){n(o)}).start()})},d.prototype.mute=function(){return this.gainCache(this.options.gain),this.gain(0),this.options.muted=!0,"element"===this.options.sourceMode&&(this.element.muted=!0),this},d.prototype.unmute=function(){return this.options.muted=!1,"element"===this.options.sourceMode&&(this.element.muted=!1),this.gain(this.options.gainCache),this},d.prototype.currentTime=function(e){return this.status.ready?"number"==typeof e?(p.log(2,'setting track "'+this.name+'" to time',e),Detect.webAudio&&"buffer"===this.options.sourceMode?this.status.playing?(this.pause(e),this.play()):this.options.cachedTime=e:this.element.currentTime=e,this):this.status.playing?Detect.webAudio&&"buffer"===this.options.sourceMode?this.source.context.currentTime-this.options.startTime||0:this.element.currentTime||0:this.options.cachedTime||0:void 0},d.prototype.formattedTime=function(e){return this.status.ready?e?u(this.currentTime())+"/"+u(this.duration()):u(this.currentTime()):void 0},d.prototype.duration=function(){return this.status.ready?Detect.webAudio&&"buffer"===this.options.sourceMode?this.source.buffer.duration||0:this.element.duration||0:void 0},t.exports=d},{"./debug":2,"./detect":3,"./utils":6}],6:[function(e,t,o){var n={};t.exports=n,n.extend=function(){for(var e={},t=arguments,o=t.length,n=0;o>n;n++)for(var i in t[n])t[n].hasOwnProperty(i)&&(e[i]=t[n][i]);return e},n.constrain=function(e,t,o){return t>e?t:e>o?o:e},n.events={},n.events.on=function(e,t){return this.events[e]=this.events[e]||[],this.events[e].push(t),this},n.events.one=function(e,t){var o=this;return this.events[e]=this.events[e]||[],this.events[e].push(function(){o.off(e),t()}),this},n.events.off=function(e){return"*"===e?this.events={}:this.events[e]=[],this},n.events.trigger=function(e){if(this.events[e])for(var t=Array.prototype.slice.call(arguments,1),o=0,n=this.events[e].length;n>o;o++)"function"==typeof this.events[e][o]&&this.events[e][o].apply(this,t)}},{}]},{},[1]);
//# sourceMappingURL=helios-audio-mixer.js.map